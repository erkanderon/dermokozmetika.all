define(["vendors/jquery.$$.min","vendors/jquery.min","vendors/jquery-loading.min","vendors/jquery-validate.min","vendors/underscore.min"],{data:{validate:{submitHandler:function(e){return blocks.sections["address-book"].events.form(e),!1}}},elements:{$address_type_select:"#create-update-address-modal-address-type-select",$area:"#create-update-address-modal-area",$block:"#address-book-section-block",$btn_delete:".btn-delete",$btn_edit:".btn-edit",$btn_new:".btn-new",$form:"#create-update-address-form",$modal:"#create-update-address-modal",$city_select:"#create-update-address-modal-city-select",$town_select:"#create-update-address-modal-town-select"},events:{btn_edit:function(){return $.ajax(_.extend(blocks.sections["address-book"].requests.get_address,{url:"/srv/service/address/get/"+$$fresh(this).data("id")+"/1",success:function(e){return blocks.sections["address-book"].renders.modal(blocks.sections["address-book"].elements,_.extend(e,blocks.sections["address-book"].data),blocks.sections["address-book"].events,blocks.sections["address-book"].requests.get_towns,{modal:blocks.sections["address-book"].templates.modal,town_select:blocks.sections["address-book"].templates.town_select})}}))},btn_delete:function(){return $.ajax(_.extend(blocks.sections["address-book"].requests.delete,{url:"/srv/service/address/delete/"+$$fresh(this).data("id")}))},btn_new:function(){return $.ajax(_.extend(blocks.sections["address-book"].requests.get_address,{url:"/srv/service/address/get/0/1",success:function(e){return blocks.sections["address-book"].renders.modal(blocks.sections["address-book"].elements,_.extend(e,blocks.sections["address-book"].data),blocks.sections["address-book"].events,blocks.sections["address-book"].requests.get_towns,{modal:blocks.sections["address-book"].templates.modal,town_select:blocks.sections["address-book"].templates.town_select})}}))},address_type_select:function(){return"1"===$$fresh(this).val()?$$fresh(blocks.sections["address-book"].elements.$area).show():$$fresh(blocks.sections["address-book"].elements.$area).hide()},city_select:function(){return $.ajax(_.extend(blocks.sections["address-book"].requests.get_towns,{url:"/srv/service/region/get-towns/"+$$fresh(this).val(),success:function(e){return blocks.sections["address-book"].renders.town_select(blocks.sections["address-book"].elements.$town_select,function(e){return $$(e).removeAttr("disabled")},e,blocks.sections["address-book"].templates.town_select)}}))},form:function(e){return $.ajax($.extend(blocks.sections["address-book"].requests.save,{data:$(e).serializeArray(),url:"/srv/service/address/save/"+$(e).data("id")}))}},init:function(){$$(this.elements.$modal).detach().appendTo("body"),$.ajax(_.extend(this.requests.get_addresses,{success:function(e){return blocks.sections["address-book"].renders.block(function(e){return $$(e.$block).loading("hide")},blocks.sections["address-book"].elements,e,blocks.sections["address-book"].events,blocks.sections["address-book"].templates.block)}}))},renders:{block:function(e,s,t,o,d){$$(s.$block).html(soda(d,t)),$$fresh(s.$btn_edit).click(o.btn_edit),$$fresh(s.$btn_delete).click(o.btn_delete),$$fresh(s.$btn_new).click(o.btn_new),e(s)},modal:function(e,s,t,o,d){$$(e.$modal).html(soda(d.modal,s)),$$fresh(e.$city_select).val(s.CITY_CODE),s.IS_COMPANY_ACTIVE&&$$fresh(e.$address_type_select).val(s.IS_COMPANY_ACTIVE),$.ajax(_.extend(o,{url:"/srv/service/region/get-towns/"+s.CITY_CODE,success:function(t){return blocks.sections["address-book"].renders.town_select(e.$town_select,function(e){return $$(e).val(s.TOWN_CODE).removeAttr("disabled")},t,d.town_select)}})),$$fresh(e.$form).validate(s.validate),$$(e.$city_select).on("change",t.city_select),$$fresh(e.$address_type_select).on("change",t.address_type_select),$$(e.$modal).modal()},town_select:function(e,s,t,o){$$fresh(e).html(soda(o,t)),s(e)}},requests:{delete:{dataType:"json",success:function(e){return new Noty({layout:"bottomCenter",text:"Seçmiş olduğunuz adres başarıyla silindi",theme:"bootstrap-v4",type:"success"}).show(),blocks.sections["address-book"].init()}},get_addresses:{dataType:"json",url:"/srv/service/address/get-list"},get_address:{dataType:"json"},get_towns:{dataType:"json"},save:{dataType:"json",type:"post",success:function(e){if(e.status)return new Noty({layout:"bottomCenter",text:"Düzenlemiş olduğunuz adres başarıyla kaydedildi",theme:"bootstrap-v4",type:"success"}).show(),$$fresh(blocks.sections["address-book"].elements.$modal).modal("hide"),blocks.sections["address-book"].init()}}},templates:{block:$$("#address-book-section-block").html(),modal:$$("#create-update-address-modal").html(),town_select:'<option disabled="" selected="">İlçe seçiniz</option><option html-repeat="item in towns" value="{{item.code}}">{{item.title}}</option>'}});