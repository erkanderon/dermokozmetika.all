define(["vendors/jquery.$$.min","vendors/jquery.min","vendors/jquery-loading.min","vendors/jquery-validate.min","vendors/underscore.min"],{data:{validate:{submitHandler:function(t){return $.ajax(_.extend(blocks.sections.cart.requests.update_coupon_code,{data:$$(t).serializeArray(),success:function(t){if(t.status)return location.reload()}})),!1}}},elements:{$block:"#cart-section-block",$btn:".cart-section-block-btn",$form:"#cart-section-block-form",$input:".cart-section-block-input",$select:".cart-section-block-select"},events:{btn:function(){return $.ajax(_.extend(blocks.sections.cart.requests.delete_product,{success:function(t){if(t.status)return location.reload()},url:"/srv/service/cart/delete/"+$$(this).data("id")}))},input:function(t){return t.preventDefault(),$.ajax(_.extend(blocks.sections.cart.requests.update_campaign,{success:function(t){return t.status?location.reload():new Noty({layout:"bottomCenter",text:t.statusText,theme:"bootstrap-v4",type:"error"}).show()},url:"/srv/campaign-v2/campaign/select-campaign/"+$$fresh(this).data("group")+"/"+$$fresh(this).data("id")}))},select:function(){return $.ajax(_.extend(blocks.sections.cart.requests.update_quantity,{success:function(t){if(t.status)return location.reload()},url:"/srv/service/cart/update-item/"+$$(this).data("id")+"/"+$$(this).val()}))}},hooks:{init:{before:function(){blocks.covers["page-title"]&&(blocks.covers["page-title"].data.title=blocks.sections.cart.data.title),blocks.sections["page-title"]&&(blocks.sections["page-title"].data.title=blocks.sections.cart.data.title),blocks.widgets["page-title"]&&(blocks.widgets["page-title"].data.title=blocks.sections.cart.data.title)}}},init:function(){return $.ajax(_.extend(this.requests.get_cart,{success:function(t){return gtag("event","page_view",{ecomm_pagetype:"cart",ecomm_prodid:$.map(t.PRODUCTS,function(t){return t.PRODUCT_CODE}),ecomm_totalvalue:t.PRICE_CART,isMember:0!==MEMBER_INFO.ID,gender:MEMBER_INFO.GENDER}),_.forEach(t.PRODUCTS,function(e,s){var c,a;for(a=[],c=1,e.STOCK>"10"&&(e.STOCK="10");c<=e.STOCK;)a.push(c),c++;return t.PRODUCTS[s].STOCK=a}),t.campaigns=[],_.forEach(t.CAMPAIGN_LIST,function(e,s){if("50"!==e.GROUP&&"150"!==e.GROUP&&"200"!==e.GROUP&&"250"!==e.GROUP&&"400"!==e.GROUP)return t.campaigns.push(t.CAMPAIGN_LIST[s])}),blocks.sections.cart.renders.block(function(t){return $$(t.$block).loading("hide")},t,{$block:blocks.sections.cart.elements.$block,$btn:blocks.sections.cart.elements.$btn,$form:blocks.sections.cart.elements.$form,$input:blocks.sections.cart.elements.$input,$select:blocks.sections.cart.elements.$select},{btn:blocks.sections.cart.events.btn,input:blocks.sections.cart.events.input,select:blocks.sections.cart.events.select},blocks.sections.cart.templates.block,blocks.sections.cart.data.validate)}}))},renders:{block:function(t,e,s,c,a,n){$$(s.$block).html(soda(a,e)),$(s.$select).each(function(){return console.log($(this).data("quantity")),$(this).val($(this).data("quantity"))}),$$(s.$btn).on("click",c.btn),$$(s.$select).on("change",c.select),$$(s.$form).validate(n),$$(s.$input).on("click",c.input),t(s)}},requests:{get_cart:{dataType:"json",url:"/srv/service/cart/load"},delete_product:{dataType:"json"},update_campaign:{dataType:"json",type:"get"},update_coupon_code:{dataType:"json",type:"post",url:"/srv/service/cart/set-campaign-code"},update_quantity:{dataType:"json"}},templates:{block:$$("#cart-section-block").html()}});